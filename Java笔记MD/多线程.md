

# å¤šçº¿ç¨‹

æˆ‘ä»¬åœ¨ç©ç”µè„‘çš„æ—¶å€™å¯ä»¥è¾¹ç©å¬æ­Œè¾¹æ‰“æ¸¸æˆã€‚è¿™å°±æ˜¯å¤šçº¿ç¨‹ã€‚


**ä»€ä¹ˆæ˜¯çº¿ç¨‹**

1. çº¿ç¨‹æ˜¯ç¨‹åºæ‰§è¡Œçš„ä¸€æ¡è·¯å¾„ï¼Œä¸€ä¸ª ~~è¿›ç¨‹ä¸­å¯ä»¥åŒ…å«å¤šæ¡çº¿ç¨‹~~

2. å¤šçº¿ç¨‹å¹¶å‘æ‰§è¡Œå¯ä»¥æé«˜ç¨‹åºçš„æ•ˆç‡ï¼Œå¯ä»¥åŒæ—¶å®Œæˆå¤šé¡¹å·¥ä½œ 

3. Javaç¨‹åºä¸­èµ·ç æœ‰ä¸ªä¸»çº¿ç¨‹ä¸åƒåœ¾å›æ”¶çº¿ç¨‹

**è¿›ç¨‹ä¸çº¿ç¨‹çš„åŒºåˆ«**

è¿›ç¨‹ï¼šæœ‰ç‹¬ç«‹çš„å†…å­˜ç©ºé—´ï¼Œè¿›ç¨‹ä¸­çš„æ•°æ®å­˜æ”¾ç©ºé—´æ˜¯ç‹¬ç«‹çš„ï¼Œè‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹

çº¿ç¨‹ï¼šå †ç©ºé—´æ˜¯å…±äº«çš„ï¼Œæ ˆç©ºé—´æ˜¯ç‹¬ç«‹çš„ã€‚çº¿ç¨‹æ¶ˆè€—èµ„æºæ¯”è¿›ç¨‹å°ã€‚

**å¹¶è¡Œä¸å¹¶å‘**

åœ¨å•CPUä¸­ï¼Œæ¯ä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªç¨‹åºæ‰§è¡Œ(æ—¶é—´ç‰‡)ï¼Œå¾®è§‚ä¸Šè¿™äº›ç¨‹åºåˆ†æ—¶äº¤æ›¿è¿è¡Œã€‚

å¦‚æœæ˜¯å¤šæ ¸CPUï¼Œå¤šä»»åŠ¡å¹¶è¡Œæ‰§è¡Œã€‚â€˜å¤šæ ¸å¤„ç†å™¨â€™å³å¯ä»¥å¹¶è¡Œåœ°å¤„ç†å¤šä¸ªç¨‹åº

1. å¹¶è¡Œå°±æ˜¯ä¸¤ä¸ªä»»åŠ¡åŒæ—¶( ~~åŒä¸€æ—¶åˆ»~~)è¿›è¡Œï¼ˆéœ€è¦å¤šæ ¸CPUï¼‰

2. å¹¶å‘å°±æ˜¯ä¸¤ä¸ªä»»åŠ¡åŒæ—¶( ~~åŒä¸€æ—¶é—´æ®µ~~)è¯·æ±‚è¿è¡Œï¼Œè€Œå¤„ç†å™¨åªå¯ä»¥æ¥å—ä¸€ä¸ªä»»åŠ¡

> ### åˆ›å»ºçº¿ç¨‹çš„ä¸‰ç§é€”å¾„

- ç»§æ‰¿Threadç±»
- å®ç°Runnableæ¥å£
- callableæ¥å£


**æ–¹å¼ä¸€**


- ç»§æ‰¿Threadç±»
- é‡å†™runæ–¹æ³•
- å°†è¦æ‰§è¡Œçš„ä»£ç å†™åœ¨runæ–¹æ³•ä¸­
- åˆ›å»ºThreadç±»çš„å­ç±»å¯¹è±¡
- å¼€å¯çº¿ç¨‹Start();


```java
public class Main {
    public static void main(String[] args){
        Test1 t = new Test1();
        t.start();
        /*Mainæ–¹æ³•çš„è¿è¡Œ*/
        for(int i=0; i<50; i++) {
            System.out.println("Main\t"+i);
        }
    }
}

class Test1 extends Thread{
    public Test1(){
        super();
    }
    @Override
    public void run(){ //1.è¦†å†™Runæ–¹æ³•
        for(int i=0; i<50; i++){
            System.out.println("Test1\t"+i);
        }
    }
}
```

**æ–¹å¼äºŒ**

```java
public class Mian {
    public static void main(String[] args){
        Test2 t = new Test2();
        new Thread(t).start();

        for(int i=0; i<50; i++) {
            System.out.println("Main\t"+i);
        }

    }
}

class Test2 implements Runnable{
    public void run() {
        for(int i=0; i<50; i++) {
            System.out.println("Test\t"+i);
        }
    }
}
```


**æ–¹å¼ä¸‰**

```java
import java.util.concurrent.FutureTask;
import java.util.concurrent.*;
public class _03åˆ›å»ºçº¿ç¨‹ {
    public static void main(String[] agrs)throws Exception{
        Test3 t = new Test3();
        /*FutureTaskæ˜¯Runnableæ¥å£çš„å­ç±»ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨Threadç±»çš„æ„é€ æ¥æ¥å—taskå¯¹è±¡*/
        FutureTask<String> a = new FutureTask<String>(t);
        FutureTask<String> b = new FutureTask<String>(t);
        FutureTask<String> c = new FutureTask<String>(t);
        new Thread(a).start();//å¯åŠ¨å¤šçº¿ç¨‹;
        new Thread(b).start();//å¯åŠ¨å¤šçº¿ç¨‹;
        new Thread(c).start();//å¯åŠ¨å¤šçº¿ç¨‹;

        System.out.println("Açº¿ç¨‹çš„è¿”å›ç»“æœ\t"+a.get());
        System.out.println("Bçº¿ç¨‹çš„è¿”å›ç»“æœ\t"+b.get());
        System.out.println("Cçº¿ç¨‹çš„è¿”å›ç»“æœ\t"+c.get());
    }
}

/*å¤šçº¿ç¨‹æ“ä½œç±»*/
class Test3 implements Callable<String>{
    private int ticket = 10;
    @Override
    public String call() throws Exception {
        for(int i=0; i<100; i++)
        {
            if(this.ticket>0){
                System.out.println("å–ç¥¨äº† ticket="+this.ticket--);
            }
        }
        return "ç¥¨å·²å–å…‰äº†";
    }
}
```

**çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ**

- æ–°å»ºçŠ¶æ€new

å½“newå‡ºä¸€ä¸ªThreadå¯¹è±¡å³è¿›å…¥äº†æ–°å»ºçŠ¶æ€

- å°±ç»ªçŠ¶æ€runnable

è°ƒç”¨`start()`æ–¹æ³•  

- è¿è¡ŒçŠ¶æ€running
- é˜»å¡çŠ¶æ€blocked

ç­‰å¾…é˜»å¡ è¿è¡ŒçŠ¶æ€ä¸­çš„`wait()`æ–¹æ³•

åŒæ­¥é˜»å¡ è·å–`synchronized`åŒæ­¥é”å¤±è´¥

å…¶ä»–é˜»å¡ `sleep()`æˆ–`join()`çº¿ç¨‹å°±ä¼šè¿›å…¥é˜»å¡çŠ¶æ€

- æ­»äº¡çŠ¶æ€dead

æ‰§è¡Œå®Œäº†æˆ–è€…å¼‚å¸¸é€€å‡ºäº†run()æ–¹æ³•ï¼Œå°±ç»“æŸäº†ç”Ÿå‘½å‘¨æœŸ






> ### å¤šçº¿ç¨‹ä¸¤ç§å®ç°æ–¹å¼çš„åŒºåˆ«

ä¸»è¦æ˜¯ ~~æ•°æ®å…±äº«~~

~~å¤šä¸ªçº¿ç¨‹å¯¹è±¡è®¿é—®åŒä¸€ä¸ªçš„å¯¹è±¡ç”¨Runnable.~~

**åŒºåˆ«ï¼š**

- Threadç±»æ˜¯Runnableæ¥å£çš„å­ç±»ï¼Œä½¿ç”¨Runnableæ¥å£å®ç°å¤šçº¿ç¨‹å¯ä»¥é¿å…å•ç»§æ‰¿å±€é™
- Runnableæ¥å£å®ç°çš„å¤šçº¿ç¨‹å¯ä»¥æ¯”Threadç±»å®ç°çš„å¤šçº¿ç¨‹çš„æ›´åŠ æ¸…æ¥šçš„æè¿°æ•°æ®å…±äº«






### çº¿ç¨‹çš„ä¼˜å…ˆçº§

- è®¾ç½®ä¼˜å…ˆçº§ public final void setPriority(int new Priority)
- å–å¾—ä¼˜å…ˆçº§ public final int getPriority()
- æœ€é«˜ä¼˜å…ˆçº§ public static final int MAX_PRIORITY;  10 
- ä¸­ç­‰ä¼˜å…ˆçº§ public static final int NORM_PRIORITY;	5
- æœ€ä½ä¼˜å…ˆçº§ public static final int MIN_PRIORITY;	1





### åŒæ­¥ä¸å¼‚æ­¥


è§£å†³çº¿ç¨‹å¹¶å‘è®¿é—®å¤šä¸€ä¸ªèµ„æºçš„å®‰å…¨æ€§é—®é¢˜ã€‚

åœ¨Javaé‡Œé¢å¦‚æœæƒ³è¦å®ç°çº¿ç¨‹çš„åŒæ­¥å¯ä»¥ä½¿ç”¨synchronizedå…³é”®å­—

- åŒæ­¥ä»£ç å—
- åŒæ­¥æ–¹æ³•
- åŒæ­¥é”ğŸ”’

> #### åŒæ­¥ä»£ç å—

**åŒæ­¥é”**ï¼šä¸ºäº†ä¿è¯æ¯ä¸ªçº¿ç¨‹éƒ½èƒ½æ­£å¸¸æ‰§è¡Œæ“ä½œï¼Œjavaå¼•å…¥äº†çº¿ç¨‹åŒæ­¥æœºåˆ¶ã€‚åŒæ­¥ç›‘å¬å¯¹è±¡|åŒæ­¥é”|äº’æ–¥é” 

~~å¯¹è±¡çš„åŒæ­¥é”åªæ˜¯ä¸€ä¸ªæ¦‚å¿µï¼Œå¯ä»¥æƒ³è±¡ä¸ºåœ¨å¯¹è±¡ä¸Šæ ‡è®°äº†ä¸€ä¸ªé”~~

```java
(synchronized(åŒæ­¥é”){
	ä»£ç å—
}
```

```java
//æ¼”ç¤º
synchronized (this) {
    if (num > 0) {
        System.out.println(Thread.currentThread() + "\t" + num--);
    }
}
```

> #### åŒæ­¥æ–¹æ³•

ä½¿ç”¨`synchronized`ä¿®é¥°çš„æ–¹æ³•å°±æ˜¯åŒæ­¥æ–¹æ³•ï¼Œä¿è¯Açº¿ç¨‹æ‰§è¡Œè¯¥æ–¹æ³•çš„æ—¶å€™,å…¶ä»–çº¿ç¨‹åªèƒ½åœ¨æ–¹æ³•å¤–ç­‰ç€

```java
public synchronized void method_name() {
	ä»£ç å—
}
```

åŒæ­¥æ“ä½œä¸å¼‚æ­¥æ“ä½œç›¸æ¯”ï¼Œå¼‚æ­¥æ“ä½œçš„æ‰§è¡Œé€Ÿåº¦è¦é«˜äºåŒæ­¥æ“ä½œã€‚ä½†æ˜¯åŒæ­¥æ“ä½œæ˜¯å®‰å…¨çº¿ç¨‹æ“ä½œ

> synchronizedçš„å¥½ä¸åï¼Ÿ

å¥½å¤„ï¼šä¿è¯äº†å¤šçº¿ç¨‹å¹¶å‘è®¿é—®çš„åŒæ­¥æ“ä½œï¼Œé¿å…çº¿ç¨‹å®‰å…¨é—®é¢˜

åå¤„ï¼šä»£ç çš„æ€§èƒ½å°±ä½äº†



> #### åŒæ­¥é”

```java
    private int num = 50;//è‹¹æœä¸ªæ•°
    // Step1
    private final Lock lock = new ReentrantLock(); //åˆ›å»ºä¸€ä¸ªé”å¯¹è±¡

    @Override
    public void run() {
        for (int i = 0; i < 50; i++) {
            eat();
        }
    }

    private void eat() {
        //Step2
        lock.lock(); //ç«‹é©¬åŠ é”
        if (num > 0) {
            try {
                System.out.println(Thread.currentThread() + "\t" + this.num);
                Thread.sleep(100);
                num--;
            } catch (Exception e) {
                e.printStackTrace();
            } finally {
                //Step3
                lock.unlock();//é‡Šæ”¾é”
            }
        }

    }
```



### çº¿ç¨‹é€šä¿¡




### æ­»é”

çº¿ç¨‹åŒæ­¥è¿‡å¤šå°±å¯èƒ½é€ æˆæ­»é”

### çº¿ç¨‹ä¼˜å…ˆçº§

```java
public class Main {
    public static void main(String[] args){
        Test4 mt = new Test4();
        Thread t = new Thread(mt, "å•Šå“ˆ");
        /*è®¾ç½®ä¼˜å…ˆçº§*/
        t.setPriority(Thread.MAX_PRIORITY);//æœ€é«˜ä¼˜å…ˆçº§

        t.start();
    }
}

class Test5 implements Runnable{
    @Override
    public void run() {
        //System.out.println(Thread.currentThread().getName()); //é»˜è®¤åå­— Thread-0
        System.out.println(Thread.currentThread().getName());/*è·å–çº¿ç¨‹çš„åå­—*/
        for(int i=0; i<500; i++){
            System.out.println(i);/*æ‰“å°è¾“å‡º*/
        }
    }
}
```




### ç”Ÿäº§è€…ä¸æ¶ˆè´¹è€…

- ç­‰å¾…  `public final void wait() throws InterruptedException`
- å”¤é†’ç¬¬ä¸€ä¸ªç­‰å¾…çº¿ç¨‹ `public final void notify()`
- å”¤é†’å…¨éƒ¨ç­‰å¾…çº¿ç¨‹ï¼Œé‚£ä¸ªä¼˜å…ˆçº§é«˜å°±å…ˆæ‰§è¡Œ `public final void notifyAll()`



### æ€»ç»“

`Thread.currentThread()` å¯ä»¥è·å–å½“å‰çº¿ç¨‹ç±»çš„å¯¹è±¡

`Thread.sleep()`ä¸»è¦æ˜¯ä¼‘çœ 

ä¼˜å…ˆçº§è¶Šé«˜çš„çº¿ç¨‹å¯¹è±¡è¶Šæœ‰å¯èƒ½å…ˆæ‰§è¡Œ 


> å¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€èµ„æºæ—¶éœ€è¦è€ƒè™‘åˆ°å“ªäº›æƒ…å†µï¼Ÿæœ‰å¯èƒ½å¸¦æ¥å“ªäº›é—®é¢˜ï¼Ÿ

å¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€èµ„æºæ—¶ä¸€å®šè¦å¤„ç†å¥½åŒæ­¥ï¼Œå¯ä»¥ä½¿ç”¨åŒæ­¥ä»£ç å—æˆ–åŒæ­¥æ–¹æ³•æ¥è§£å†³

ä½†æ˜¯è¿‡å¤šçš„ä½¿ç”¨åŒæ­¥æœ‰å¯èƒ½é€ æˆæ­»é”


> è¯·è§£é‡Šsleep()ä¸wait()æ–¹æ³•çš„åŒºåˆ«

sleep()æ˜¯Threadç±»å®šä¹‰çš„æ–¹æ³• wait()æ˜¯Objectç±»å®šä¹‰çš„æ–¹æ³•

sleep()å¯ä»¥è®¾ç½®ä¼‘çœ æ—¶é—´ï¼Œæ—¶é—´ä¸€åˆ°è‡ªåŠ¨å”¤é†’

wait()éœ€è¦ç­‰å¾…notify()è¿›è¡Œå”¤é†’;



**æ¡ˆä¾‹**


- åƒè‹¹æœæ¯”èµ›

ä¸‰ä¸ªçº¿ç¨‹å…±äº«ä¸€ä¸ªå¯¹è±¡ï¼Œä¸€ä¸ªPersonå¯¹è±¡æœ‰50ä¸ªè‹¹æœæ•°é‡
```java

public class Main {
    public static void main(String[] args) {
        Person p = new Person();
        new Thread(p, "å°æ˜").start();
        new Thread(p, "å°èŠ±").start();
        new Thread(p, "å°åˆš").start();

    }
}

class Person implements Runnable {
    /**
     *      éœ€è¦è®¾ç½®staticï¼Œå®ç°ç±»å…±äº«
     * */
    private int num = 50;//è‹¹æœä¸ªæ•°

    @Override
    public void run() {
        for (int i = 0; i < 50; i++) {
            if (num > 0) {
                System.out.println(Thread.currentThread() + "\t" + num--);
            }
        }
    }
}
```



